---
title:  3Tier 구성 방법 #주제
excerpt: "Nick Pury." #닉네임
search: true
categories: 
  - Cloud #대분류
  - application #소분류
tags: 
  - 3 Tier #주요 핵심 단어
toc: true
comments: true

last_modified_at: 2019-10-04T00:03:00+09:00

## -- 블로그 글위에 이미지 추가
#header:
#  image: https://cdn.pixabay.com/photo/2019/06/27/06/49/plane-4301615_1280.png

## -- 블로그 글위에 색상 추가
#xcerpt: "This post should display a **header with a solid background color**, if the theme #supports it."
#header:
#  overlay_color: "#333"

# -- 블로그 글위에 배경 추가 및 링크 추가
xcerpt: "This post should [...]"
header:
  overlay_image: /assets/images/hannah-rodrigo-mf_3yZnC6ug-unsplash.jpg
  overlay_filter: 0.5 # same as adding an opacity of 0.5 to a black background
  caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
  actions:
    - label: "Download"
      url: "https://github.com"

---

## 3Tier 구축

### 3Tier?
 - 2 tier 구조에서 웹 애플리케이션 보안 취약점 보안과 웹 서버의 과부화를 막기 위해 3 tier   아키택처 등장
 - Presentation(Client) -> Application -> Data 구조로 각 계층별로 독립적으로 분리 시켜    놓은 구조


### 구성도

![screenshot](/assets/images/3tier/1.png "width:300px;height:100px")

### 구성방법

구성 순서는 아래와 같다.
1. WEB1번 서버 설치 (Apache 2.4.39 Version)
2. WAS1번 서버 설치(tomcat 7.0.76)
3. WEB1번 서버와 WAS1번 서버 연동
4. AMI를 통한 WEB2, WAS2번 배포
5. RDS 구축



1. WEB 서버
![screenshot](/assets/images/3tier/2.png "width:300px;height:100px")

WEB서버 접속 후 YUM을 통해 Apache를 설치한다.
Apache만을 단독으로 할경우 더이상 작업이 필요없지만, 
WAS와 연동 할경우 추후 mod_jk 모듈과 빌드 하기위해 httpd-devel 패키를 설치해준다.

![screenshot](/assets/images/3tier/3.png "width:300px;height:100px")


![screenshot](/assets/images/3tier/4.png "width:300px;height:100px")

기본적인 Index.html파일을 만들어 준뒤 Apache서비스를 시작한다.

![screenshot](/assets/images/3tier/5.png "width:300px;height:100px")


ELB 생성(ALB)

![screenshot](/assets/images/3tier/6.png "width:300px;height:100px")

ELB를 생성하고 난뒤,
DNS 이름 주소를 가지고 WEB 접속을 확인한다.

![screenshot](/assets/images/3tier/7.png "width:300px;height:100px")




2. WAS 서버

Apache 설치 및 테스트가 완료 되었다면, Tomcat을 설치하자


java 설치
![screenshot](/assets/images/3tier/8.png "width:300px;height:100px")

Tomcat 설치
yum -y install tomcat 
yum -y install tomcat-admin-webapps
yum -y install tomcat-webapps
yum -y install tomcat-docs-webapp

Tomcat 서비스 시작
service tomcat start

Tomcat 설치가 완료 되었다면 Tomcat 웹페이지 확인


ELB 구성(NLB)
![screenshot](/assets/images/3tier/9.png "width:300px;height:100px")


ELB를 생성하고 난뒤 Tomcat접속 확인
![screenshot](/assets/images/3tier/10.png "width:300px;height:100px")


3. WEB, WAS 서버 연동

Apache와 Tomcat을 연동 할때에는 mod_jk 라는 톰캣 커넥터를 사용한다.
물론 mod_jk외에도 두개 더있다. 많이 사용하는건 mod_jk이다.

http://tomcat.apache.org/download-connectors.cgi

해당 링크를 눌러보자.
해당링크는 톰캣 웹 화면 하단에 Tocat Connectors에서 확인 할수 있다.
![screenshot](/assets/images/3tier/11.png "width:300px;height:100px")

해당 링크를 접속 하고 나면
jk…..tar.gz 파일이 보이면 오른쪽 마우스를 클릭하여 링크를 복사하자

해당 작업은 아파치에서 톰캣과 연동을 해야 되기 때문에 아파치에서 작업한다.

Wget 톰캣 커넥터를 명령어로 다운 받는다.
![screenshot](/assets/images/3tier/12.png "width:300px;height:100px")


다운이 다 받아졌다면 해당 압축 파일을 풀어주자

mod_jk를 빌드하는데 반드시 필요하므로 먼저 gcc 패키지를 설치한다
yum -y install gcc

만약 gcc를 설치 하지않고 빌드시 아래와 같은 에러메세지가 나온다.
![screenshot](/assets/images/3tier/14.png "width:300px;height:100px")

그리고 mod_jk를 빌드하려면 httpd-devel 패키지가 있어야 한다.
httpd-devel 패키지를 설치하면 apxs가 설치가 된다.
![screenshot](/assets/images/3tier/13.png "width:300px;height:100px")
해당 위치가 /usr/bin/apxs 이지만 
/sbin/apxs 인경우도 있다.

해당 경로(apxs)를 확인한후 소스 폴더 안에 native 폴더로 이동하여 아래 명령어로 빌드 및 설치를 해보자.

cd tomcat-connector-x.x.xx-src
cd native
./configure --with-apxs=/bin/apxs
make
make install

mod_jk의 설치가 완료 되었으면 아파치의 설정을 수정할 것이다. 수정하기에 앞서 톰캣의 설정을 확인해본다.
톰캣은 기본 설치 상태에서 이미 AJP/1.3 요청은 8009 포트로 받도록 되어있다.
해당 설정은 /etc/tomcat/server.xml 에서 확인 할수 있다.
![screenshot](/assets/images/3tier/15.png "width:300px;height:100px")

아파치와 톰캣 연동시 설정사항
1. /etc/httpd/conf/httpd.conf 수정
2. /etc/httpd/conf/workers.properties 수정
위에 두곳을 설정할것이다.

/etc/httpd/conf/httpd.conf 수정

1) index.jsp 추가  

<IfModule dir_module>
    DirectoryIndex index.jsp  index.html
</IfModule>

2) 맨 아래 추가

LoadModule jk_module modules/mod_jk.so

<VirtualHost *:80>
 ServerName localhost
  # 확장자 jsp, json, xml, do를 가진 경로는 woker tomcat으로 연결하는 구문입니다.     
  JkMount /*.jsp tomcat     
  JkMount /*.json tomcat     
  JkMount /*.xml tomcat     
  JkMount /*.do tomcat 
  JKMount /*.css tomcat
  JKMount /*.png tomcat
</VirtualHost>


<IfModule mod_jk.c>
 # 워커 설정파일 위치
 JkWorkersFile conf/workers.properties
 # 공유 메모리파일 위치 반드시 Selinux 보안때문에 run에 위치 필수     
 JkShmFile run/mod_jk.shm     
 # log 위치     
 JkLogFile logs/mod_jk.log     
 # 로그레벨 설정     
 JkLogLevel info     
 # 로그 포맷에 사용할 시간 형식을 지정한다.     
 JkLogStampFormat "[%y %m %d %H:%M:%S] " 
</IfModule>


 /etc/httpd/conf/workers.properties 수정

worker.list=tomcat
worker.server1.port=8009
worker.tomcat.host= NLB주소 입력
worker.tomcat.type=ajp13
worker.tomcat.lbfactor=1

모든 수정사항이 완료되었다면,
아파치,톰캣에대한 연동은 완료 되었다.

이제 ALB의 DNS 주소를 웹에 입력하면 톰캣의 화면이 나온다.




